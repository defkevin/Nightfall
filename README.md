# Nightfall
Nightfall Sales Engineering Take Home Assignment

# Intro:
This script and flask server will help you upload and scan a file to Nightfall's servers, retrieve the findings and display them.

1. Follow Nightfall [documentation](https://docs.nightfall.ai/docs/quickstart) to create a new detection rule using either a custom detector or one of Nightfall’s pre-built detectors.
	- For my included script, I created a detection rule called “Kevin's First Detection Rule” which returns a positive finding if the string ‘kevin’ is found. (regex: 'kevin')
	- Test to make sure your detection rule is behaving correctly using the [Nightfall AI Playground](https://playground.nightfall.ai/)

2. Open script named ‘scan_file.py’ and update with
    - API Key
    - Signing Secret
    - Webhook Url
    - The detection rule UUID you want to apply 

Make sure to not hardcode the api keys or the signing key and to use [environment variables](https://www.nylas.com/blog/making-use-of-environment-variables-in-python/) instead.


3. Set up a webhook that will receive the Nightfall response once the file is finished scanning by Nightfall.
    1. When Nightfall prepares a file scan operation, it will issue a challenge to the webhook server to verify its legitimacy. Nightfall will send a JSON payload with a single field 'challenge' containing randomly-generated bytes when a scan request is made. When the webhook server receives the request, it must return the value of the challenge key in plaintext.
    2. To test locally, a flask app can be created that integrates with ngrok. You can test your webhook with a tool such as [ngrok](https://dashboard.ngrok.com/get-started/setup) which allows you expose a web server running on your local machine to the internet. Additional [resource on webhooks with Nightfall](https://docs.nightfall.ai/docs/creating-a-webhook-server)


4. Once you have:
    1. Updated all environ variables with your information
    2. Set up the webhook and ngrok

5. Start your flask application!
 ```
 run flask
 ```

6. Send the scan_file request to Nightfall
```
python3 scan_file.py absolute_path_filename.txt
```

7. Results will be printed in the logs of the flask server. Check “Findings results:”. Use the [json beautify url](https://codebeautify.org/jsonviewer) to view the json data in a more readable format. 
